generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String     @id @default(cuid())
  name          String?
  email         String     @unique
  emailVerified DateTime?
  password      String?
  image         String?
  phone         String?
  role          UserRole   @default(USER)
  status        UserStatus @default(ACTIVE)
  accounts      Account[]
  properties    Property[]
  inquiries     Inquiry[]
  activityLogs  ActivityLog[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Property {
  id             String          @id @default(cuid())
  title          String
  description    String          @db.Text
  price          Float
  address        String
  city           String
  state          String
  zipCode        String
  bedrooms       Int
  bathrooms      Int
  squareFeet     Int
  propertyType   PropertyType
  category       PropertyCategory
  status         PropertyStatus  @default(ACTIVE)
  approvalStatus ApprovalStatus  @default(APPROVED)
  isFeatured     Boolean         @default(false)
  featuredOrder  Int?
  images         String[]
  views          Int             @default(0)
  agentId        String
  agent          User            @relation(fields: [agentId], references: [id])
  inquiries      Inquiry[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@index([agentId])
  @@index([status])
  @@index([city])
  @@index([propertyType])
  @@index([approvalStatus])
}

model Inquiry {
  id            String        @id @default(cuid())
  propertyId    String
  property      Property      @relation(fields: [propertyId], references: [id])
  userId        String?
  user          User?         @relation(fields: [userId], references: [id])
  visitorName   String
  visitorEmail  String
  visitorPhone  String?
  message       String        @db.Text
  status        InquiryStatus @default(NEW)
  notes         String?       @db.Text
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([propertyId])
  @@index([userId])
  @@index([status])
}

model Settings {
  id                    String   @id @default(cuid())
  platformName          String   @default("ASYLEN VENTURES")
  platformTagline       String   @default("Your Dream Property Awaits")
  companyEmail          String?
  companyPhone          String?
  companyAddress        String?
  logoUrl               String?
  enableRegistrations   Boolean  @default(true)
  enablePropertyCreation Boolean @default(true)
  enableInquiries       Boolean  @default(true)
  requireEmailVerification Boolean @default(false)
  requirePhoneVerification Boolean @default(false)
  supportEmail          String?
  noReplyEmail          String?
  updatedAt             DateTime @updatedAt
}

model ActivityLog {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  action      String
  entityType  String
  entityId    String?
  details     String?  @db.Text
  ipAddress   String?
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

enum UserRole {
  ADMIN
  AGENT
  USER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BANNED
}

enum PropertyType {
  HOUSE
  APARTMENT
  CONDO
  TOWNHOUSE
  LAND
  COMMERCIAL
}

enum PropertyCategory {
  SALE
  RENT
  LEASE
}

enum PropertyStatus {
  ACTIVE
  PENDING
  SOLD
  RENTED
  INACTIVE
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InquiryStatus {
  NEW
  CONTACTED
  CONVERTED
  LOST
}
